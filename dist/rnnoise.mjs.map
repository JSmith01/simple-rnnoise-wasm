{"version":3,"file":"rnnoise.mjs","sources":["webpack://simple-rnnoise-wasm/webpack/runtime/define_property_getters","webpack://simple-rnnoise-wasm/webpack/runtime/has_own_property","webpack://simple-rnnoise-wasm/./src/rnnoise.js"],"sourcesContent":["__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n        if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n            Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n        }\n    }\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","/**\r\n * Prepare the assets for the RNNoise processor\r\n *\r\n * @param {string|URL} [scriptSrc]\r\n * @param {string|BufferSource} [moduleSrc]\r\n * @returns {[string|URL, Promise<WebAssembly.Module>]}\r\n */\r\nfunction rnnoise_loadAssets({ scriptSrc, moduleSrc } = {}) {\r\n    const { origin, pathname } = window.document.location;\r\n    const base = origin + pathname.substring(0, pathname.lastIndexOf('/') + 1);\r\n    scriptSrc = scriptSrc || base + 'rnnoise.worklet.js';\r\n    moduleSrc = moduleSrc || base + 'rnnoise.wasm';\r\n    const module = typeof moduleSrc == 'string' ? WebAssembly.compileStreaming(fetch(moduleSrc)) : WebAssembly.compile(moduleSrc);\r\n\r\n    return [scriptSrc, module];\r\n}\r\n\r\nclass RNNoiseNode extends AudioWorkletNode {\r\n    /**\r\n     * Register the RNNoise processor with the AudioContext\r\n     *\r\n     * @param context\r\n     * @param {[string|URL, Promise<WebAssembly.Module>]} [assetData]\r\n     * @returns {Promise<void>}\r\n     */\r\n    static async register(context, assetData) {\r\n        if (RNNoiseNode.ready) {\r\n            return context.audioWorklet.addModule(RNNoiseNode.scriptSrc);\r\n        }\r\n\r\n        assetData = assetData || await rnnoise_loadAssets();\r\n        let [scriptSrc, module] = assetData;\r\n        RNNoiseNode.scriptSrc = scriptSrc;\r\n\r\n        return Promise.all([\r\n            context.audioWorklet.addModule(scriptSrc),\r\n            module.then(m => { this.module = m; })\r\n        ]).then(() => { this.ready = true; });\r\n    }\r\n\r\n    /**\r\n     * @type {null | WebAssembly.Module}\r\n     */\r\n    static module = null;\r\n\r\n    /**\r\n     * @type {null | string | URL}\r\n     */\r\n    static scriptSrc = null;\r\n\r\n    static ready = false;\r\n\r\n    /**\r\n     * @type {function(Event):void | null}\r\n     */\r\n    onstatus = null;\r\n\r\n    /**\r\n     * @param {AudioContext} context\r\n     */\r\n    constructor(context) {\r\n        if (!RNNoiseNode.ready) throw new Error('Call RNNoiseNode.register() first');\r\n\r\n        super(context, 'rnnoise', {\r\n            channelCountMode: 'explicit',\r\n            channelCount: 1,\r\n            channelInterpretation: 'speakers',\r\n            numberOfInputs: 1,\r\n            numberOfOutputs: 1,\r\n            outputChannelCount: [1],\r\n            processorOptions: {\r\n                module: RNNoiseNode.module\r\n            }\r\n        });\r\n\r\n        this.port.onmessage = ({ data }) => {\r\n            const e = Object.assign(new Event('status'), data);\r\n            this.dispatchEvent(e);\r\n            if (this.onstatus)\r\n                this.onstatus(e);\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Update the VAD probability, if keepalive is false, the processor will be terminated\r\n     *\r\n     * @param {boolean|'stat'} [keepalive]\r\n     */\r\n    update(keepalive = true) {\r\n        this.port.postMessage(keepalive);\r\n    }\r\n}\r\n\r\nexport { RNNoiseNode, rnnoise_loadAssets };\r\n"],"names":["Object","o","window","WebAssembly","fetch","AudioWorkletNode","Promise","Error","Event"],"mappings":"QAAA,GAAoB,CAAC,CAAG,CAAC,EAAS,KACjC,IAAI,IAAI,KAAO,EACL,EAAoB,CAAC,CAAC,EAAY,IAAQ,CAAC,EAAoB,CAAC,CAAC,EAAS,IACzEA,OAAO,cAAc,CAAC,EAAS,EAAK,CAAE,WAAY,GAAM,IAAK,CAAU,CAAC,EAAI,AAAC,EAGzF,ECNA,EAAoB,CAAC,CAAG,CAAC,EAAK,IAAUA,OAAO,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,EAAK,G,SCOlF,SAAS,EAAmB,CAAE,WAAS,CAAE,WAAS,CAAE,CAAG,CAAC,CAAC,EACrD,GAAM,CAAEC,OAAAA,CAAM,CAAE,UAAQ,CAAE,CAAGC,OAAO,QAAQ,CAAC,QAAQ,CAC/C,EAAOD,EAAS,EAAS,SAAS,CAAC,EAAG,EAAS,WAAW,CAAC,KAAO,GAKxE,MAAO,CAJP,EAAY,GAAa,EAAO,qBAEjB,AAAoB,UAApB,MADf,GAAY,GAAa,EAAO,cAAa,EACCE,YAAY,gBAAgB,CAACC,MAAM,IAAcD,YAAY,OAAO,CAAC,GAEzF,AAC9B,C,wBAEA,OAAM,UAAoBE,iBAQtB,aAAa,SAAS,CAAO,CAAE,CAAS,CAAE,CACtC,GAAI,EAAY,KAAK,CACjB,OAAO,EAAQ,YAAY,CAAC,SAAS,CAAC,EAAY,SAAS,EAI/D,GAAI,CAAC,EAAW,EAAO,CADvB,EAAY,GAAa,MAAM,IAI/B,OAFA,EAAY,SAAS,CAAG,EAEjBC,QAAQ,GAAG,CAAC,CACf,EAAQ,YAAY,CAAC,SAAS,CAAC,GAC/B,EAAO,IAAI,CAAC,IAAO,IAAI,CAAC,MAAM,CAAG,CAAG,GACvC,EAAE,IAAI,CAAC,KAAQ,IAAI,CAAC,KAAK,CAAG,EAAM,EACvC,CAKA,OAAO,OAAS,IAAK,AAKrB,QAAO,UAAY,IAAK,AAExB,QAAO,MAAQ,EAAM,AAKrB,UAAW,IAAK,AAKhB,aAAY,CAAO,CAAE,CACjB,GAAI,CAAC,EAAY,KAAK,CAAE,MAAM,AAAIC,MAAM,qCAExC,KAAK,CAAC,EAAS,UAAW,CACtB,iBAAkB,WAClB,aAAc,EACd,sBAAuB,WACvB,eAAgB,EAChB,gBAAiB,EACjB,mBAAoB,CAAC,EAAE,CACvB,iBAAkB,CACd,OAAQ,EAAY,MAAM,AAC9B,CACJ,GAEA,IAAI,CAAC,IAAI,CAAC,SAAS,CAAG,CAAC,CAAE,MAAI,CAAE,IAC3B,IAAM,EAAIP,OAAO,MAAM,CAAC,IAAIQ,MAAM,UAAW,GAC7C,IAAI,CAAC,aAAa,CAAC,GACf,IAAI,CAAC,QAAQ,EACb,IAAI,CAAC,QAAQ,CAAC,EACtB,CACJ,CAOA,OAAO,EAAY,EAAI,CAAE,CACrB,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,EAC1B,CACJ,C"}